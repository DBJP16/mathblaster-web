<!DOCTYPE html>
<html>
<head>
    <title>Math Blaster with Profiles</title>
    <style>
        canvas {
            border: 1px solid white;
            background: black;
            display: none; /* Hidden until game starts */
        }
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #222;
            color: white;
            font-family: Arial, sans-serif;
        }
        #score, #question {
            font-size: 24px;
            margin: 10px;
            display: none; /* Hidden until game starts */
        }
        #answerInput {
            margin: 10px;
            display: none; /* Hidden until game starts */
        }
        #profileScreen {
            text-align: center;
        }
        #gameScreen {
            display: none; /* Hidden until profile is created */
        }
    </style>
</head>
<body>
    <!-- Profile creation screen -->
    <div id="profileScreen">
        <h1>Create Your Math Blaster Profile</h1>
        <input type="text" id="usernameInput" placeholder="Enter your username">
        <button onclick="startGame()">Start Game</button>
    </div>

    <!-- Game screen -->
    <div id="gameScreen">
        <div id="score">Score: 0</div>
        <div id="question"></div>
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <input type="number" id="answerInput" placeholder="Enter answer">
    </div>

    <script>
        // Wait for DOM to load
        window.onload = function() {
            // DOM elements
            const profileScreen = document.getElementById('profileScreen');
            const gameScreen = document.getElementById('gameScreen');
            const usernameInput = document.getElementById('usernameInput');
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const scoreDisplay = document.getElementById('score');
            const questionDisplay = document.getElementById('question');
            const answerInput = document.getElementById('answerInput');

            // Game variables
            let player = { x: 400, y: 550, width: 40, height: 20 };
            let enemies = [];
            let bullets = [];
            let currentQuestion = {};
            let score = 0;
            let username = '';
            let rightPressed = false;
            let leftPressed = false;

            // Generate math question
            function generateQuestion() {
                const num1 = Math.floor(Math.random() * 10) + 1;
                const num2 = Math.floor(Math.random() * 10) + 1;
                currentQuestion = { num1: num1, num2: num2, answer: num1 + num2 };
                questionDisplay.textContent = `${username}, what is ${num1} + ${num2}?`;
            }

            // Spawn enemy
            function spawnEnemy() {
                enemies.push({
                    x: Math.random() * (canvas.width - 30),
                    y: 0,
                    width: 30,
                    height: 30,
                    speed: 2
                });
            }

            // Check answer and spawn bullet
            function checkAnswer() {
                const userAnswer = parseInt(answerInput.value);
                if (userAnswer === currentQuestion.answer) {
                    bullets.push({ x: player.x + player.width / 2, y: player.y, speed: 5 });
                    score += 10;
                    scoreDisplay.textContent = `Score: ${score}`;
                    answerInput.value = '';
                    generateQuestion();
                }
            }

            // Start the game after profile creation
            window.startGame = function() {
                username = usernameInput.value.trim() || 'Player'; // Default to 'Player' if empty
                profileScreen.style.display = 'none';
                gameScreen.style.display = 'block';
                canvas.style.display = 'block';
                scoreDisplay.style.display = 'block';
                questionDisplay.style.display = 'block';
                answerInput.style.display = 'block';

                // Initialize game
                generateQuestion();
                setInterval(spawnEnemy, 2000);
                answerInput.focus();
                update(); // Start game loop
            };

            // Keyboard controls
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowRight') rightPressed = true;
                if (e.key === 'ArrowLeft') leftPressed = true;
                if (e.key === 'Enter') checkAnswer();
            });

            document.addEventListener('keyup', (e) => {
                if (e.key === 'ArrowRight') rightPressed = false;
                if (e.key === 'ArrowLeft') leftPressed = false;
            });

            // Game loop
            function update() {
                try {
                    // Clear canvas
                    ctx.fillStyle = 'black';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    // Move and draw player
                    if (rightPressed && player.x < canvas.width - player.width) player.x += 5;
                    if (leftPressed && player.x > 0) player.x -= 5;
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.moveTo(player.x, player.y);
                    ctx.lineTo(player.x + player.width / 2, player.y - player.height);
                    ctx.lineTo(player.x + player.width, player.y);
                    ctx.fill();

                    // Update and draw enemies
                    enemies.forEach((enemy, index) => {
                        enemy.y += enemy.speed;
                        ctx.fillStyle = 'red';
                        ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                        ctx.fillStyle = 'white';
                        ctx.fillText(currentQuestion.answer, enemy.x + 10, enemy.y + 20);
                        if (enemy.y > canvas.height) {
                            enemies.splice(index, 1);
                            score -= 5;
                            scoreDisplay.textContent = `Score: ${score}`;
                        }
                    });

                    // Update and draw bullets
                    bullets.forEach((bullet, bIndex) => {
                        bullet.y -= bullet.speed;
                        ctx.fillStyle = 'yellow';
                        ctx.fillRect(bullet.x, bullet.y, 2, 10);
                        enemies.forEach((enemy, eIndex) => {
                            if (bullet.x > enemy.x && bullet.x < enemy.x + enemy.width &&
                                bullet.y > enemy.y && bullet.y < enemy.y + enemy.height) {
                                enemies.splice(eIndex, 1);
                                bullets.splice(bIndex, 1);
                                score += 20;
                                scoreDisplay.textContent = `Score: ${score}`;
                            }
                        });
                    });

                    requestAnimationFrame(update);
                } catch (error) {
                    console.error('Game loop error:', error);
                }
            }
        };
    </script>
</body>
</html>